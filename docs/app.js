// F1 Predictor - App JavaScript

// Sample predictions data (would be generated by Python model)
const predictionsData = {
    bahrain: {
        round: 1,
        name: "Bahrain Grand Prix",
        date: "March 2, 2025",
        predictions: [
            { pos: 1, driver: "VER", team: "Red Bull Racing", prob: 42.3 },
            { pos: 2, driver: "NOR", team: "McLaren", prob: 18.7 },
            { pos: 3, driver: "LEC", team: "Ferrari", prob: 12.4 },
            { pos: 4, driver: "SAI", team: "Ferrari", prob: 8.2 },
            { pos: 5, driver: "PIA", team: "McLaren", prob: 6.1 },
            { pos: 6, driver: "HAM", team: "Ferrari", prob: 4.8 },
            { pos: 7, driver: "RUS", team: "Mercedes", prob: 3.2 },
            { pos: 8, driver: "PER", team: "Red Bull Racing", prob: 2.1 }
        ]
    },
    saudi: {
        round: 2,
        name: "Saudi Arabian Grand Prix",
        date: "March 9, 2025",
        predictions: [
            { pos: 1, driver: "VER", team: "Red Bull Racing", prob: 38.5 },
            { pos: 2, driver: "LEC", team: "Ferrari", prob: 19.2 },
            { pos: 3, driver: "NOR", team: "McLaren", prob: 15.8 },
            { pos: 4, driver: "SAI", team: "Ferrari", prob: 9.4 },
            { pos: 5, driver: "PIA", team: "McLaren", prob: 6.7 },
            { pos: 6, driver: "HAM", team: "Ferrari", prob: 4.2 },
            { pos: 7, driver: "RUS", team: "Mercedes", prob: 3.1 },
            { pos: 8, driver: "ALO", team: "Aston Martin", prob: 1.8 }
        ]
    },
    australia: {
        round: 3,
        name: "Australian Grand Prix",
        date: "March 16, 2025",
        predictions: [
            { pos: 1, driver: "VER", team: "Red Bull Racing", prob: 35.2 },
            { pos: 2, driver: "NOR", team: "McLaren", prob: 21.4 },
            { pos: 3, driver: "LEC", team: "Ferrari", prob: 14.8 },
            { pos: 4, driver: "PIA", team: "McLaren", prob: 10.2 },
            { pos: 5, driver: "SAI", team: "Ferrari", prob: 7.6 },
            { pos: 6, driver: "HAM", team: "Ferrari", prob: 5.1 },
            { pos: 7, driver: "RUS", team: "Mercedes", prob: 3.4 },
            { pos: 8, driver: "PER", team: "Red Bull Racing", prob: 1.2 }
        ]
    }
};

// Team colors
const teamColors = {
    "Red Bull Racing": "#3671C6",
    "Ferrari": "#E8002D",
    "McLaren": "#FF8000",
    "Mercedes": "#27F4D2",
    "Aston Martin": "#229971",
    "Alpine": "#FF87BC",
    "Williams": "#64C4FF",
    "RB": "#6692FF",
    "Sauber": "#52E252",
    "Haas F1 Team": "#B6BABD"
};

// Initialize the app
function init() {
    const raceSelect = document.getElementById('race-select');
    raceSelect.addEventListener('change', (e) => {
        updatePredictions(e.target.value);
    });

    // Smooth scroll for nav links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (e) => {
            const href = link.getAttribute('href');
            if (href.startsWith('#')) {
                e.preventDefault();
                document.querySelector(href).scrollIntoView({
                    behavior: 'smooth'
                });

                // Update active state
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
            }
        });
    });

    // Animate probability bars on load
    setTimeout(() => {
        animateBars();
    }, 300);
}

function updatePredictions(raceKey) {
    const race = predictionsData[raceKey];
    if (!race) return;

    // Update header
    document.querySelector('.race-round').textContent = `ROUND ${race.round}`;
    document.querySelector('.race-name').textContent = race.name;
    document.querySelector('.race-date').textContent = race.date;

    // Update prediction cards
    const grid = document.querySelector('.predictions-grid');
    grid.innerHTML = '';

    race.predictions.forEach((pred, index) => {
        const podiumClass = index === 0 ? 'podium gold' :
            index === 1 ? 'podium silver' :
                index === 2 ? 'podium bronze' : '';

        const card = document.createElement('div');
        card.className = `prediction-card ${podiumClass}`;
        card.innerHTML = `
            <div class="position">${pred.pos}</div>
            <div class="driver-info">
                <span class="driver-name">${pred.driver}</span>
                <span class="team">${pred.team}</span>
            </div>
            <div class="probability">
                <span class="prob-value">${pred.prob.toFixed(1)}%</span>
                <div class="prob-bar">
                    <div class="prob-fill" style="width: 0%"></div>
                </div>
            </div>
        `;
        grid.appendChild(card);
    });

    // Animate new bars
    setTimeout(animateBars, 100);
}

function animateBars() {
    document.querySelectorAll('.prob-fill').forEach(bar => {
        const targetWidth = bar.parentElement.parentElement.querySelector('.prob-value').textContent;
        bar.style.width = targetWidth;
    });
}

// Wait for DOM
document.addEventListener('DOMContentLoaded', init);
